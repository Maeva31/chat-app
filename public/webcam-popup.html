<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Webcam Popup</title>
  <style>
    body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; }
    video { max-width: 100%; max-height: 100%; border-radius: 8px; border: 2px solid #ccc; }
  </style>
</head>
<body>
  <video id="webcamVideo" autoplay playsinline muted></video>

  <script>
    const video = document.getElementById('webcamVideo');

    // Écoute le message du parent avec le pseudo
    window.addEventListener('message', async (event) => {
      if (event.data && event.data.type === 'init') {
        const username = event.data.username || 'inconnu';
        console.log('Webcam popup pour:', username);

        try {
          // Demande la webcam locale (audio désactivé ici)
          const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
          video.srcObject = stream;
        } catch (e) {
          alert("Impossible d'accéder à la webcam : " + e.message);
        }
      }
    }, false);

    // Optionnel : demander la webcam tout de suite (sans message)
    // navigator.mediaDevices.getUserMedia({ video: true, audio: false })
    //   .then(stream => video.srcObject = stream)
    //   .catch(e => alert("Erreur webcam : " + e.message));
  </script>
</body>
</html>
